<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="css/jquery.mobile.structure.min.css" />
        <link rel="stylesheet" type="text/css" href="css/jquery.mobile.theme.min.css" />
        <link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css" />
        <link rel="stylesheet" type="text/css" href="css/jquery-ui.structure.css" />
        <link rel="stylesheet" type="text/css" href="css/jquery-ui.theme.css" />
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <link rel="stylesheet" type="text/css" href="css/color.css" />
        <script src="js/class.user.js"></script>
        <link href="img/icons/logo.png" rel="icon" />
        <title>Yarn</title>
    </head>
    <body>
        <div data-role="page" id="foo">

            <!--HEADER-->
            <!--data-id="header"-->
            <div data-id="header" data-role="header" class="ts-header">
                <div class="row">
                    <div class="col-xs-7">
                        <div class="ts-user-wrapper">
                            <div class="ts-user-img v-top">
                                <img src="img/icons/default_contact.png" alt="user" />
                            </div>
                            <div class="ts-user-name v-bottom">
                                Name
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-5 text-right">
                        <a href="#" class="ts-chat-icon">
                            <img src="img/icons/chat.png" />
                        </a>
                    </div>
                </div>
            </div>

            <!--LOGO-->
            <!--data-id="logo"-->
            <div data-id="logo" data-role="logo" class="row ts-logo-wrapper center">
                <a href="http://yarn-me.com">
                    <img src="img/icons/logo.png" alt="logo" />
                </a>
            </div>

            <!--BALANCE + NUMPAD-->
            <!--data-id="bal-num"-->
            <div data-id="bal-num" role="main" class="ui-content">
                <!--BALANCE-->
                <!--data-id="balance"-->
                <div data-id="balance" class="row ts-balance-wrapper">
                    <div class="col-xs-6 center">
                        <div>Rate</div>
                        <div>(or FREE if App2App Call)</div>
                    </div>
                    <div class="col-xs-6 center ts-balance-child">
                        <span>Balance:</span>
                        <span class="ts-balance orange bold">
                            <a class="orange" href="#">
                                $10.00
                                <i class="glyphicon glyphicon-plus-sign"></i>
                            </a>
                        </span>
                    </div>
                </div>

                <!--INPUT-->
                <div>
                    <input class="ts-input" name="dial-input" type="text"  data-id="input" />
                    <a href="#" class="ts-icon-delete" data-id="delete">
                        <img src="img/icons/delete.png" alt="delete" />
                    </a>
                </div>
                <!--NUMPAD-->
                <!--data-id="numpad"-->
                <div data-id="numpad" data-id="numpad" class="row ts-numpad orange bold">
                    <div data-line="1" class="row">
                        <div class="col-xs-4">
                            <span data-value="1">1</span>
                        </div>
                        <div class="col-xs-4">
                            <span data-value="2">2</span>
                            <sub class="ts-sub-text">abc</sub>
                        </div>
                        <div class="col-xs-4">
                            <span data-value="3">3</span>
                            <sub class="ts-sub-text">def</sub>
                        </div>
                    </div>

                    <div data-line="2" class="row">
                        <div class="col-xs-4">
                            <span data-value="4">4</span>
                            <sub class="ts-sub-text">ghi</sub>
                        </div>
                        <div class="col-xs-4">
                            <span data-value="5">5</span>
                            <sub class="ts-sub-text">jkl</sub>
                        </div>
                        <div class="col-xs-4">
                            <span data-value="6">6</span>
                            <sub class="ts-sub-text">mno</sub>
                        </div>
                    </div>

                    <div data-line="3" class="row">
                        <div class="col-xs-4">
                            <span data-value="7">7</span>
                            <sub class="ts-sub-text">pqrs</sub>
                        </div>
                        <div class="col-xs-4">
                            <span data-value="8">8</span>
                            <sub class="ts-sub-text">tuv</sub>
                        </div>
                        <div class="col-xs-4">
                            <span data-value="9">9</span>
                            <sub class="ts-sub-text">wxyz</sub>
                        </div>
                    </div>

                    <div data-line="4" class="row">
                        <div class="col-xs-4">
                            <span data-value="*">*</span>
                        </div>
                        <div class="col-xs-4">
                            <span data-value="0">0</span>
                            <sub>+</sub>
                        </div>
                        <div class="col-xs-4">
                            <span data-value="#">#</span>
                        </div>
                    </div>

                </div>
            </div>

            <!--SUB FOOTER-->
            <!--data-id="sub-footer"-->
            <div data-id="sub-footer" class="ts-sub-footer">
                <div class="ui-grid-a">
                    <div class="ui-block-a center right-border">
                        <a href="#" class="ts-icon-button btn">
                            <img src="img/icons/phone-wifi.png" />
                        </a>
                    </div>
                    <div class="ui-block-b center">
                        <a href="#" class="ts-icon-button btn">
                            <img src="img/icons/phone.png" />
                        </a>
                    </div>
                </div>
            </div>

            <!--FOOTER-->
            <!--data-id="footer"-->
            <div data-id="footer" data-role="footer" class="ts-footer">
                <div class="ui-grid-c">
                    <div class="ui-block-a">
                        <a href="#" class="ts-icon-button btn">
                            <img src="img/icons/tv.png" />
                        </a>
                    </div>
                    <div class="ui-block-b">
                        <a href="#" class="ts-icon-button btn">
                            <img src="img/icons/contacts.png" />
                        </a>
                    </div>
                    <div class="ui-block-c">
                        <a href="#" class="ts-icon-button btn">
                            <img src="img/icons/logs.png" />
                        </a>
                    </div>
                    <div class="ui-block-d">
                        <a href="#" class="ts-icon-button btn">
                            <img src="img/icons/settings.png" />
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!--SCRIPT-->
        <script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="js/jquery.mobile.min.js"></script>
        <script type="text/javascript" src="js/jquery-ui.min.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/app.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="js/my_linphone.js"></script>
        
        <script type="text/javascript">
            app.initialize();
            if (global.get('auth') === null) {
                var username = getUrlParameter('username');
                var password = getUrlParameter('password');
                console.log(username);
                console.log(password);
                if (username !== null && password !== null) {
                    window.location.href = 'auto.html?u=' + username + '&p=' + password;
                } else {
                    //window.location = 'login.html';
                }
            }

            if (global.get('auto_login') === 'true') {
                $('#logout_option').hide();
            } else if (global.get('auto_login') === 'false') {
                $('#logout_option').show();
            }
        </script>
        <script>
            function sipRegister(response) {
            	var user = global.getUser();
            	var sipUsername = response;
            	//var password = user.data.uipass
                password = '123456';
                window.registerSip(sipUsername, password, function(message) {
                    //empty
                });
            }
            
            
            global.getSipUsernameApi('anh@test.com', '123456', sipRegister);
            
            if (global.get('auth') === null) {
                // Second test
                //window.location.href = 'login.html';
            } else {
                
                var user = global.getUser();
                var user_id = user.getId();
                var currency = user.getCurrency();
                $('#user_name').html(user.getFirstName() + ' ' + user.getLastName());
                if (user.getCurrency() !== 'NGN') {
                    $('#connect').show();
                }
                balance_display_in_button();


                global.getSipUsernameApi(user.data.email, user.data.uipass, sipRegister);
                global.api('usage_and_sms_last_month', {user_id: user_id, currency: currency}, usage_and_sms_last_month_display);

            }

            function usage_and_sms_last_month_display(result) {
                var voice_total = result.details['voice_total'];
                var data_total = result.details['data_total'];
                var sms_total = result.details['sms_total'];

                var html = ' <img src="img/dashboard.png" width="50" height="50" style="vertical-align:middle;">  ';
                html += ' Last Month\'s Portal Usage - ' + voice_total + ' mins';

                $('#title').html(html);
            }

        </script>
    </body>
</html>
